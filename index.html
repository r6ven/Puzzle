<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  <title>10 Par√ßalƒ± Puzzle Oyunu</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3/dist/phaser.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; background: #444; }
    #congrats {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%) scale(1);
      opacity: 0;
      font-size: 5.333rem;
      color: #ff69b4;
      text-shadow: 0 0 10px #fff, 0 0 20px #ff69b4;
      pointer-events: none;
      z-index: 10;
      white-space: nowrap;
    }
    #congrats.show {
      opacity: 1;
      transform: translate(-50%, -50%) scale(1);
      animation: showAnim 1.2s forwards;
    }
    @keyframes showAnim {
      0%   { opacity: 0; transform: translate(-50%, -50%) scale(0.5) rotate(-15deg); }
      60%  { opacity: 1; transform: translate(-50%, -50%) scale(1.2) rotate(15deg); }
      100% { opacity: 1; transform: translate(-50%, -50%) scale(1) rotate(0deg); }
    }
  </style>
</head>
<body>
  <div id="congrats">Seni √ßok seviyorum üíñ</div>
  <script>
    const regionPaths = [
      // Her par√ßa i√ßin doƒürudan √ßer√ßeveden elde ettiƒüiniz koordinat dizileri:
      // √ñrnek: [{x:10,y:10},{x:110,y:10},...,{x:10,y:110}],
      // Toplam 10 adet path.
    ];

    const config = {
      type: Phaser.AUTO,
      width: 360 * 3,
      height: 600 * 3,
      backgroundColor: '#333',
      parent: document.body,
      scene: { preload, create }
    };
    new Phaser.Game(config);

    function preload() {
      this.load.image('puzzle', '1000156285.jpg');
    }

    function create() {
      const img = this.textures.get('puzzle').getSourceImage();
      const frameW = config.width - 20;
      const scale = frameW / img.width;
      const frameH = img.height * scale;
      const slots = [];

      // 1) √ñl√ßekli √ßer√ßeve boyutu ve slot merkezleri
      const cols = 4, rows = 5;  // 4 s√ºtun √ó 5 satƒ±r = 20 par√ßa
      const pw = frameW / cols, ph = frameH / rows;
      let idx = 0;
      for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols; c++) {
          slots.push({ x: 10 + c * pw + pw/2, y: 10 + r * ph + ph/2 });
        }
      }

      // 2) Her regionPath i√ßin mask olu≈ütur ve par√ßa texture'ƒ± bake et
      regionPaths.forEach((path, i) => {
        // Graphics ile vekt√∂r ≈üekli √ßiz
        const shape = this.make.graphics({ x:0, y:0, add:false });
        shape.fillStyle(0xffffff);
        shape.beginPath();
        path.forEach((pt, j) => {
          if (j === 0) shape.moveTo(pt.x*scale+10, pt.y*scale+10);
          else        shape.lineTo(pt.x*scale+10, pt.y*scale+10);
        });
        shape.closePath();
        shape.fillPath();

        // Mask olarak kaydet
        const mask = shape.createGeometryMask();

        // Fotoƒürafƒ± mask ile RenderTexture'a √ßiz
        const rt = this.make.renderTexture({ width: pw, height: ph, add:false });
        const imgSprite = this.add.image(0,0,'puzzle').setOrigin(0).setMask(mask);
        rt.draw(imgSprite, -slots[i].x + pw/2, -slots[i].y + ph/2);
        rt.saveTexture('piece'+i);
        shape.destroy(); imgSprite.destroy();
      });

      // 3) Par√ßalarƒ± rastgele yerle≈ütir
      const snapDist = pw;
      const particles = this.add.particles();
      let placedCount = 0;

      regionPaths.forEach((_, i) => {
        const spr = this.add.image(
          Phaser.Math.Between(pw/2, config.width-pw/2),
          Phaser.Math.Between(frameH+20, config.height-ph/2),
          'piece'+i
        ).setInteractive().setDisplaySize(pw, ph);
        this.input.setDraggable(spr);
        spr.correctX = slots[i].x;
        spr.correctY = slots[i].y;
        spr.on('pointerup', () => {
          const d = Phaser.Math.Distance.Between(spr.x,spr.y,spr.correctX,spr.correctY);
          if (d < snapDist) {
            spr.x = spr.correctX; spr.y = spr.correctY;
            spr.disableInteractive(); placedCount++;
            if (placedCount === regionPaths.length) {
              document.getElementById('congrats').classList.add('show');
              // Confetti
              const emitter = particles.createEmitter({
                x: { min: 0, max: config.width },
                y: 0,
                speed: { min:200, max:400 },
                lifespan: 2000,
                scale: { start:1, end:0 },
                quantity: 100
              });
            }
          }
        });
      });
    }
  </script>
</body>
</html>
