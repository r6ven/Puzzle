<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>HTML Puzzle Oyunu</title>
  <style>
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: Arial, sans-serif;
      font-size: 0.5em; /* Yazı fontu yarı boyutuna indirildi */
      margin: 20px;
    }
    #puzzleCanvas {
      margin-top: 20px;
      box-shadow: 0 0 10px rgba(0,0,0,0.5);
      cursor: pointer;
    }
    #message {
      margin-top: 15px;
      font-size: 1.2em; /* Mesajı biraz daha büyük göstermek isterseniz burayı ayarlayabilirsiniz */
      color: green;
    }
  </style>
</head>
<body>
  <h1>Sliding Puzzle Oyunu</h1>
  <p>“puzzle.jpg” adındaki görselinizi bu klasöre koyun ve oyuna başlamak için tabloya tıklayın.</p>
  <canvas id="puzzleCanvas"></canvas>
  <div id="message"></div>

  <script>
    const ROWS = 4, COLS = 4;
    let canvas = document.getElementById('puzzleCanvas');
    let ctx = canvas.getContext('2d');
    let img = new Image();
    img.src = 'puzzle.jpg';
    let tileWidth, tileHeight;
    let tiles = [];
    let blankIndex;
    let shuffled = false;

    img.onload = () => {
      tileWidth  = img.width  / COLS;
      tileHeight = img.height / ROWS;
      canvas.width  = img.width;
      canvas.height = img.height;

      for (let i = 0; i < ROWS*COLS; i++) {
        let x = (i % COLS) * tileWidth;
        let y = Math.floor(i / COLS) * tileHeight;
        tiles.push({ sx: x, sy: y, index: i });
      }
      blankIndex = tiles.length - 1;

      draw();
      canvas.addEventListener('click', onClick);
    };

    function shuffle() {
      for (let i = 0; i < 1000; i++) {
        let n = neighbors(blankIndex);
        let rnd = n[Math.floor(Math.random() * n.length)];
        swap(blankIndex, rnd);
        blankIndex = rnd;
      }
      shuffled = true;
    }

    function neighbors(idx) {
      let x = idx % COLS, y = Math.floor(idx / COLS);
      let list = [];
      if (x > 0)          list.push(idx - 1);
      if (x < COLS - 1)   list.push(idx + 1);
      if (y > 0)          list.push(idx - COLS);
      if (y < ROWS - 1)   list.push(idx + COLS);
      return list;
    }

    function swap(i, j) {
      [tiles[i], tiles[j]] = [tiles[j], tiles[i]];
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let i = 0; i < tiles.length; i++) {
        if (i === blankIndex) {
          let bx = (i % COLS) * tileWidth;
          let by = Math.floor(i / COLS) * tileHeight;
          ctx.fillStyle = '#ccc';
          ctx.fillRect(bx, by, tileWidth, tileHeight);
        } else {
          let t = tiles[i];
          let dx = (i % COLS) * tileWidth;
          let dy = Math.floor(i / COLS) * tileHeight;
          ctx.drawImage(
            img,
            t.sx, t.sy, tileWidth, tileHeight,
            dx,   dy,   tileWidth, tileHeight
          );
        }
      }
    }

    function onClick(e) {
      if (!shuffled) {
        shuffle();
        draw();
        return;
      }
      let rect = canvas.getBoundingClientRect();
      let mx = e.clientX - rect.left;
      let my = e.clientY - rect.top;
      let cx = Math.floor(mx / tileWidth);
      let cy = Math.floor(my / tileHeight);
      let idx = cy * COLS + cx;

      if (neighbors(blankIndex).includes(idx)) {
        swap(blankIndex, idx);
        blankIndex = idx;
        draw();

        if (isSolved()) {
          document.getElementById('message').textContent = '🎉 Tebrikler! Puzzle tamamlandı.';
          canvas.removeEventListener('click', onClick);
        }
      }
    }

    function isSolved() {
      for (let i = 0; i < tiles.length; i++) {
        if (tiles[i].index !== i) return false;
      }
      return true;
    }
  </script>
</body>
</html>
